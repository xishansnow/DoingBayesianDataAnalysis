# 第五章 贝叶斯规则

<p style="text-indent:2em">

在你所在地区的典型日子里，多云的可能性有多大？假设你被告知正在下雨，那么现在多云的可能性有多大？请注意，这两个概率不相等，因为我们可以非常确定  $p(多云)<p(多云|下雨)$ 。假设你被告知外面每个人都戴着太阳镜，最有可能的是 $p(多云)>p(多云|太阳镜) $。

我们在这个气象例子中进行了推论。首先在两种可能的天空状态上分配了事先的可信度：多云或晴天。然后考虑了其他一些数据，即“正在下雨”或“人们戴着太阳镜”。根据新数据，我们重新分配了各种可能天空状态的可信度。当数据显示“有雨”时，那么“多云”比我们开始的时候更可信。相反，当数据显示为“太阳镜”时，“多云”的情况就不像我们开始时那么可信了。贝叶斯规则仅仅是基于数据，对先验可信度分配和后验可信度再分配之间的的数学关系。

## 5.1 贝叶斯规则

托马斯·贝叶斯（1702-1761）是英国一位数学家和长老会牧师。他的著名定理在其死后的1763年出版，这要归功于他的朋友理查德·普莱斯的努力。这条简单规则对统计推理有巨大的影响，但贝叶斯自己可能没有完全意识到这些影响，许多历史学家认为它是贝叶斯的继任者，其中拉普拉斯(Pierre-Simon Laplace，1749-1827)的影响力最大，因为是拉普拉斯独立地重新发现并广泛发展了这些方法。

统计学的另一个分支称为频率统计，它不使用贝叶斯规则进行推理和决策。第11章描述了频率主义方法及其危险。这种方法通常被认为是另一位来自英格兰的杰出人物罗纳德·费舍尔（Ronald Fisher，1890-1962），其以频率分析中常用的 $F值$ 被永垂不朽。令人好奇的是，20世纪占压倒性主导地位的菲舍尔方法正在21世纪让位于起源于18世纪的贝叶斯方法。

### 5.1.1 从条件概率的定义导出

从条件概率的直观定义导出，回到公式4.9中，即：
$$
p(c \mid r)=\frac{p(r, c)}{p(r)}
$$
换句话说，这个定义简单地说，在给定条件 $r$ 下 $c$ 发生的概率，等于 $r,c$ 一起发生的概率除 $r$ 单独发生的概率。现在我们做一些非常简单的代数运算。

首先，将公式两边乘以 $p(r)$ 得到：
$$
p ( c \mid r ) p ( r ) = p ( r , c )
$$
其次，可以从定义 $p(r \mid c)=p(r,c)/p(c)$ 开始执行类似的操作，以获得：
$$
p(r \mid c) p(c)=p(r, c)
$$
公式 5.2 和 5.3 是等于 $p(r,c)$ 的两个不同表达式，因此知道这两个表达式彼此相等：
$$
p(c \mid r) p(r)=p(r \mid c) p(c)
$$
现在将最后一个表达式的两边除以 $p(r)$ ，得到：
$$
p ( c | r ) = \frac { p ( r | c ) p ( c ) } { p ( r ) }
$$
但我们还没有完全完成，因为我们可以用 $p(r|c)$ 重写分母，就像我们在公式4.9中所做的那样。因此：
$$
p ( c | r ) = \frac { p ( r | c ) p ( c ) } { \sum _ { c* } p ( r | c  ^ {*} ) p ( c ^ { *} ) }
$$
在方程式 5.6 中，分子中的 $c$ 是一个特定的固定值，而分母中的 $c^∗$ 是一个变量，它采用所有可能的值。方程式 5.5 和 5.6 称为贝叶斯法则。这种简单关系是贝叶斯推理的核心。在公式 5.6 的形式下，它似乎不是特别简洁，但很快就会看到它如何以强大的方式应用于数据分析。同时，我们将更直观地了解贝叶斯规则是如何工作的。

### 5.1.2 从双向离散表直观得出的贝叶斯规则

考虑表 5.1，它显示行属性和列属性的联合概率以及它们的边缘概率。在每个单元格中，联合概率$p(r,c)$ 由公式 5.3 中条件概率的定义中的等价形式 $p(r|c)p(c)$ 重新表示。边缘概率 $p(r)$ 用等价形式重新表示为 $\sum_{c^∗}p(r|c^∗)p(c^∗)$ ，如公式 4.9  和 5.6 中所做的那样。注意，贝叶斯规则的分子是联合概率 $p(r,c)$ ，贝叶斯规则的分母是边缘概率 $p(r)$ 。由表5.1可知，贝叶斯规则让我们在关注行值 $r$ 时，目光从底部的边缘分布 $p(c)$ 逐步过渡到条件分布 $p(c|r)=p(r,c)/p(r)$  。总而言之，根据已知行值进行条件化就像将注意力限制在该已知值为真的行，然后通过除以该行的总概率来归一化该行中的概率。这种空间注意力行为，当用代数表示时，就产生了贝叶斯法则。

![](https://gitee.com/XiShanSnow/imagebed/raw/master/images/articles/spatialPresent_20210427115854_38.webp)

现在让我们重温一下上一章提供的有关眼睛颜色和头发颜色、从边缘概率到条件概率的案例。表 5.2 显示了眼睛颜色和头发颜色的各种组合的联合和边缘概率。在对一个人的眼睛颜色一无所知的情况下，我们所相信的关于头发颜色的所有东西都是由头发颜色的边际概率表示的，在表 5.2 的底部；然而，如果我们被告知一个随机选择的人的眼睛是蓝色的，那么我们就知道这个人来自表的“Blue”行，我们可以将注意力集中在该行上。在给定眼睛颜色的情况下，我们计算头发颜色的条件概率，如表5.3 所示。请注意，我们已经从先前未知眼睛颜色时的头发颜色先验（边缘）信念，转到观察到眼睛颜色后的头发颜色的“后验”(条件)信念。例如：在不知道眼睛颜色的情况下，这个人群中金发的概率是0.21，但如果知道眼睛是蓝色的，那么金发的概率是0.45。

![](https://gitee.com/XiShanSnow/imagebed/raw/master/images/articles/spatialPresent_20210427121202_79.webp)

![](https://gitee.com/XiShanSnow/imagebed/raw/master/images/articles/spatialPresent_20210427121456_d1.webp)



## 5.2 应用于参数和数据



## 5.3 完整的例子：估计硬币的偏差



## 5.4 为什么贝叶斯推断很难

根据贝叶斯规则直接确定后验分布涉及到计算证据(也称为。公式5.8和5.9中的边际似然)。在通常的连续参数情况下，公式5.9中的积分可能无法解析求解。从历史上看，积分的困难是通过将模型限制为相对简单的似然函数，以及先验分布的相应公式(称为共轭先验)来解决的，这些似然函数与似然函数“配合得很好”，从而产生了易于处理的积分。本书稍后将说明这种共轭优先方法的几个案例，但本书将改为强调现代计算机方法的灵活性。当共轭先验方法不起作用时，另一种选择是用其他更容易使用的函数来逼近实际函数，然后证明在典型条件下这种逼近是相当好的。这种方法被称为“变分近似”。“。本书没有提供任何变分近似的例子，但参见Grimmer(2011)的概述和指向其他来源的指针。

与解析数学方法不同，另一类方法涉及积分的数值逼近。当参数空间较小时，一种数值近似方法是用梳子或网格覆盖该空间，并通过对该网格进行穷举求和来计算积分。这是我们在图5.2和5.3中使用的方法，在图5.2和5.3中，参数θ的域由值的精细梳理表示，连续参数θ上的积分由许多离散代表值的总和近似。但是，此方法不适用于具有许多参数的模型。在许多现实模型中，有几十个甚至数百个参数。可能性空间是包含参数值的所有组合的联合参数空间。如果我们用1000个值的梳子表示每个参数，那么对于P个参数，有1000P个参数值组合。即使是中等大小的P，也会有太多的组合，即使是现代计算机也无法处理。

另一种近似涉及从后验分布随机抽样大量具有代表性的参数值组合。近几十年来，已经发展了许多这样的算法，通常被称为马尔可夫链蒙特卡罗(MCMC)方法。这些方法之所以如此有用，是因为它们可以从复杂模型的后验分布生成具有代表性的参数值组合，而不需要计算贝叶斯规则中的积分。正是这些MCMC方法的发展使贝叶斯统计方法得到了实际应用。这本书的重点是MCMC方法，用于现实的数据分析。

## 5.5 习题

练习请参见https://sites.google.com/site/doingbayesiandataanalysis/

练习5.1中的更多练习。[目的：迭代应用贝叶斯规则，观察后验概率如何随着数据的增加而变化。]。本练习扩展了Ta b l e 5的概念。4，所以在这个时候，请复习一下Ta b l e 5。4及其在正文中的讨论。假设与Ta b l e 5中随机选择的人相同。4在第一次检测结果为阳性后进行复检，复检结果为阴性。当考虑到这两个测试的结果时，这个人患这种疾病的概率是多少？提示：对于重新测试的先验概率，请使用从Ta b l e 5计算的后验概率。4.尽可能多地保留小数位，因为四舍五入可能会对结果产生令人惊讶的巨大影响。避免不必要舍入的一种方法是做

练习5.2中的计算。[目的]用“自然频率”和“马尔可夫”表示对以前的结果有一个直观的认识。

(A)假设人口由10万人组成。计算一下预计会有多少人落入Ta b l e 5的每个单元格。4.要计算单元格中人的预期频率，只需将单元格概率乘以人口大小即可。为了让您开始，这里填写了频率表中的几个单元格：

<img src="https://gitee.com/XiShanSnow/imagebed/raw/master/images/articles/spatialPresent_20210426223719_81.webp" style="zoom:50%;" />

请注意表格下边空白处的频率。他们指出，在10万人中，只有100人患有这种疾病，而99900人没有这种疾病。这些边际频率实例化了p(θ=？)=0.001的先验概率。还要注意列θ=？中的细胞频率，它表明在100名患者中，99人检测结果呈阳性，1人检测结果为阴性。这些蜂窝频率实例化了0.99的命中率。我们这部分练习的工作是填充表中剩余单元格的频率。

(B)仔细看一看你刚刚计算的前一部分的表中的频率。这些是事件的所谓“自然频率”，而不是在条件概率方面有些不直观的表达(Gigerenzer&Hoffrange，1995)。如果检测结果呈阳性，仅从细胞频率就可以确定患有这种疾病的比例。在算术计算精确答案之前，只需查看D=+行中的相对频率，即可给出一个大致直观的答案。你的直觉答案是否与你最初阅读Ta b l e 5时提供的直觉答案相符？4？大概不会吧。你的直观答案可能更接近正确答案。现在用算术计算准确答案。它应该与在Ta b l e 5中应用贝叶斯规则的结果相匹配。4.

(C)现在我们将考虑用自然频率表示概率的相关表示，这在我们积累更多数据时特别有用。这种类型的表示被克劳斯、马提格农和霍夫拉奇(1999)称为“马尔可夫”表示。假设现在我们从N=1000万人口开始。我们预期其中99.9%(即9990,000人)不会患上该病，而只有0.1%(即10,000人)会患上该病。现在想一想，我们预计会有多少人检测呈阳性。在10000名患有这种疾病的人中，99%(即9900人)的检测结果将呈阳性。在9990000名没有感染这种疾病的人中，5%(即49.95万人)的检测结果将呈阳性。现在考虑重新测试所有在第一次测试中呈阳性的人。他们中有多少人在复试中预计会出现阴性结果？使用下图计算您的答案：

<img src="C:\Users\89877\AppData\Roaming\Typora\typora-user-images\image-20210426223815858.png" alt="image-20210426223815858" style="zoom:50%;" />

在计算上述空框的频率时，请注意使用正确的条件概率！

(D)用前面部分的图表来回答这个问题：最初检测呈阳性，然后重新检测为阴性的人中，实际患有这种疾病的比例是多少？换句话说，在前一部分图表底部的总人数中(那些是那些检测呈阳性然后呈阴性的人)，他们中有多少人在这棵树的左枝上呢？与你对练习5.1的回答相比，结果如何？

练习5.3。[目的：查看数据顺序不变性的实际操作示例。]。再次考虑前两个练习的疾病和诊断测试。(A)假设从整体中随机抽取的一名人士接受测试，而测试结果为阴性。计算这个人得这种病的概率。(B)该人随后再接受测试，而第二次测试的结果为阳性。计算这个人得这种病的概率。与你对练习5.1的回答相比，结果如何？

练习5.4。[目的：通过使用BernGrid直观地了解贝叶斯更新。]。打开程序BernGridExample.R.Y，您会注意到有几个使用BernGrid函数的示例。运行脚本。对于每个示例，包括R代码和生成的图形，并解释该示例说明了什么想法。提示：回顾图5.2和5.3，展望未来的图6.5。其中两个例子涉及一次翻转，两个例子之间的唯一区别在于先验是一致的还是只包含两个极端选项。这两个例子的要点是，当先验是模糊的时，单个数据并不意味着什么，但是当先验只允许两种非常不同的可能性时，单个数据可能会有很强的含义。